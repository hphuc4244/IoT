<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Hệ thống điều khiển thiết bị</title>

   <!-- icon tab -->
   <link rel="icon" type="image/x-icon" href="dist/img/icon_newtab.png">

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" href="plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
  <!-- iCheck -->
  <link rel="stylesheet" href="plugins/icheck-bootstrap/icheck-bootstrap.min.css">
  <!-- JQVMap -->
  <link rel="stylesheet" href="plugins/jqvmap/jqvmap.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="plugins/daterangepicker/daterangepicker.css">
  <!-- summernote -->
  <link rel="stylesheet" href="plugins/summernote/summernote-bs4.min.css">

   <!-- thoi tiet -->
  <link rel="stylesheet" href="dist/css/Thoitiet.css">
  <!-- font chữ sử dụng hiển thị thời tiết -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Coiny&family=Lobster&family=Patua+One&family=Playball&family=Sriracha&display=swap" rel="stylesheet">


</head>

<div class="wrapper">

  <!-- Preloader -->
  <div class="preloader flex-column justify-content-center align-items-center">
    <img class="animation__shake" src="dist/img/logo.jpg" width="200px" height="200px" style="border-radius: 50%;">
  </div>

  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <!-- <a href="index3.html" class="nav-link">Home</a> -->
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <!-- <a href="#" class="nav-link">Contact</a> -->
      </li>
    </ul>

    <!-- Right navbar links -->
    <ul class="navbar-nav ml-auto">
      <!-- Navbar Search -->
      <li class="nav-item">
        <a class="nav-link" href="#" >
          <i class="fa-solid fa-house-signal"></i>
          <i id="trangthaiesp" class="fa-solid fa-house-signal" style="color: red;font-weight: bold;"> Offline</i>
        </a>
        <div class="navbar-search-block">
          <form class="form-inline">
            <div class="input-group input-group-sm">
              <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
              <div class="input-group-append">
                <button class="btn btn-navbar" type="submit">
                  <i class="fas fa-search"></i>
                </button>
                <button class="btn btn-navbar" type="button" data-widget="navbar-search">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </form>
        </div>
      </li>

      <!-- Messages Dropdown Menu -->

        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
          <a href="#" class="dropdown-item">
            <!-- Message Start -->
            <div class="media">
              <img src="dist/img/user1-128x128.jpg" alt="User Avatar" class="img-size-50 mr-3 img-circle">
              <div class="media-body">
                <h3 class="dropdown-item-title">
                  Brad Diesel
                  <span class="float-right text-sm text-danger"><i class="fas fa-star"></i></span>
                </h3>
                <p class="text-sm">Call me whenever you can...</p>
                <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
              </div>
            </div>
            <!-- Message End -->
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item">
            <!-- Message Start -->
            <div class="media">
              <img src="dist/img/user8-128x128.jpg" alt="User Avatar" class="img-size-50 img-circle mr-3">
              <div class="media-body">
                <h3 class="dropdown-item-title">
                  John Pierce
                  <span class="float-right text-sm text-muted"><i class="fas fa-star"></i></span>
                </h3>
                <p class="text-sm">I got your message bro</p>
                <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
              </div>
            </div>
            <!-- Message End -->
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item">
            <!-- Message Start -->
            <div class="media">
              <img src="dist/img/user3-128x128.jpg" alt="User Avatar" class="img-size-50 img-circle mr-3">
              <div class="media-body">
                <h3 class="dropdown-item-title">
                  Nora Silvester
                  <span class="float-right text-sm text-warning"><i class="fas fa-star"></i></span>
                </h3>
                <p class="text-sm">The subject goes here</p>
                <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
              </div>
            </div>
            <!-- Message End -->
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item dropdown-footer">See All Messages</a>
        </div>
      </li>

    </ul>
  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="index.html" class="brand-link">
      <img src="dist/img/logo.jpg" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8">
      <span class="brand-text font-weight-light">Auto</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
      <!-- Sidebar user panel (optional) -->
      <div class="user-panel mt-3 pb-3 mb-3 d-flex">
        <div class="image">
          <img src="dist/img/avt.jpg" class="img-circle elevation-2" alt="User Image">
        </div>
        <div class="info">
          <a href="#" class="d-block">Hoàng Phúc nè</a>
        </div>
      </div>

      <!-- SidebarSearch Form -->


      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->

          <li class="nav-item">
            <a  class="nav-link">
              <i class="nav-icon fas fa-th"></i>
              <p>
                Điều khiển
              </p>
       
            </a>
          </li>

        </ul>
      </nav>
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1 class="m-0">Điều khiển</h1>
          </div><!-- /.col -->
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <!-- <li class="breadcrumb-item"><a href="#">Home</a></li> -->
              <!-- <li class="breadcrumb-item active">Dashboard v1</li> -->
            </ol>
          </div><!-- /.col -->
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <!-- Small boxes (Stat box) -->
        <div class="row">
          <div  class="col-lg-3 col-6">
            <!-- small box -->
            <div  id="bat/tatden-caloc"   class="small-box bg-info">
              <div class="inner" style="background-color:#C5EFE9;">
                <h4 style="-webkit-user-select: none;user-select: none;color: black;font-weight: bold;">Đèn cá lóc  </h4>
                <img class="img_den_caloc" src="dist/img/den_off.png" width="25%"/>
                <p  style="color: #17a2b8; -webkit-user-select: none;user-select: none;"> </p>
              </div>
              <div  class="icon">
                <i  style="zoom:0.8;" class="ion-ios-lightbulb"></i>
              </div>
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div  id="bat/tatden-canho"   class="small-box bg-info" >
              <div class="inner" style="background-color:#C5EFE9;"  >
                <h4 style="-webkit-user-select: none;user-select: none;color: black;font-weight: bold;">Đèn cá nhỏ </h4>
                <img class="img_den_canho" src="dist/img/den_off.png" width="25%"/> 
                <p  style="color: rgb(83, 63, 173) ; -webkit-user-select: none;user-select: none;">  </p>
              </div>
              <div  class="icon">
                <i  style="zoom:0.8;" class="ion-ios-lightbulb"></i>
              </div>
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div id="bat/tat-nguon-1" class="small-box bg-success">
              <div class="inner" style="background-color:#E8E8E8;" >
                <h4 style="-webkit-user-select: none;user-select: none;font-weight: bold;color: black">Nguồn 1</h4>
                <img class="img_nguon_1" src="dist/img/den_off.png" width="25%"/> 
                <p  style="color: rgb(83, 63, 173) ; -webkit-user-select: none;user-select: none;">  </p>
              </div>
              <div  class="icon">
                <i  style="zoom:0.8;" class="fas fa-cog"></i>
              </div>
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div id="bat/tat-nguon-2" class="small-box bg-success">
              <div class="inner"  style="background-color:#E8E8E8;">
                <h4 style="-webkit-user-select: none;user-select: none;font-weight: bold;color: black">Nguồn 2</h4>
                <img class="img_nguon_2" src="dist/img/den_off.png" width="25%"/> 
                <p  style="color: rgb(83, 63, 173) ; -webkit-user-select: none;user-select: none;">  </p>
              </div>
              <div  class="icon">
               
                <i  style="zoom:0.8;" class="fas fa-cog"></i>
              </div>
            </div>
          </div>
          <!-- ./col -->
        </div>
        <!-- /.row -->
        <!-- Main row -->
        <!-- /.row (main row) -->
      </div><!-- /.container-fluid -->

      <!-- Thời tiết -->

      <div id="thoitiet" class="content" style='background-image: url("dist/img/Thoitiet/nang.jpg");'>
        <div id="title_thoitiet" style="padding-left: 5%;width: 100%; background-color: rgba(255, 255, 255, 0.23);border-top-left-radius: 13px; border-top-right-radius: 13px;">
          <h5 style="-webkit-user-select: none;user-select: none;" id="ngayhientai">Thứ Tư, 28.09.2023 </h5>
        </div>
        <div id="content_thoitiet" class="container-fluid">
          <span style="-webkit-user-select: none;user-select: none;" id="giatrinhietdo">24°C</span>
          <span style="-webkit-user-select: none;user-select: none;" id="vitri">Phường 2, Vĩnh Long</span>
          <p  style="-webkit-user-select: none;user-select: none;" id="trangthaithoitiet">Mưa giông</p> 
          <img style="-webkit-user-select: none;user-select: none;" id="iconthoitiet" height="auto" width="10%" src="dist/img/group_icon/01d.png"/>
          <p style="-webkit-user-select: none;user-select: none;" id="nhietdongay">Độ ẩm 20%, Nhiệt độ thấp nhất 27°</p>
        </div>
      </div> 
      <!-- <iframe width="450" height="260" style="border: 1px solid #cccccc;" src="https://thingspeak.com/channels/1760280/charts/1?average=10&bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=60&title=Bi%E1%BB%83u+%C4%91%E1%BB%93+nhi%E1%BB%87t+%C4%91%E1%BB%99&type=line"></iframe>
      <iframe width="450" height="260" style="border: 1px solid #cccccc;" src="https://thingspeak.com/channels/1760280/charts/2?average=10&bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=60&title=Bi%E1%BB%81u+%C4%91%E1%BB%93+%C4%91%E1%BB%99+%E1%BA%A9m&type=line&yaxismax=100&yaxismin=30"></iframe> -->
       <!-- test -->

      <!-- thời tiết -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->
  <footer class="main-footer">
    <strong>Copyright &copy; 2024 <a href="https://github.com/hphuc4244">Hoàng Phúc</a>.</strong>
    <div class="float-right d-none d-sm-inline-block">
      <b>Version</b> 1.0.0
    </div>
  </footer>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->



<script src="dist/js/thoitiet.js"></script>

<!-- jQuery -->
<script src="plugins/jquery/jquery.min.js"></script>
<!-- jQuery UI 1.11.4 -->
<script src="plugins/jquery-ui/jquery-ui.min.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
  $.widget.bridge('uibutton', $.ui.button)
</script>
<!-- Bootstrap 4 -->
<script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- ChartJS -->
<script src="plugins/chart.js/Chart.min.js"></script>
<!-- Sparkline -->
<script src="plugins/sparklines/sparkline.js"></script>
<!-- JQVMap -->
<script src="plugins/jqvmap/jquery.vmap.min.js"></script>
<script src="plugins/jqvmap/maps/jquery.vmap.usa.js"></script>
<!-- jQuery Knob Chart -->
<script src="plugins/jquery-knob/jquery.knob.min.js"></script>
<!-- daterangepicker -->
<script src="plugins/moment/moment.min.js"></script>
<script src="plugins/daterangepicker/daterangepicker.js"></script>
<!-- Tempusdominus Bootstrap 4 -->
<script src="plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
<!-- Summernote -->
<script src="plugins/summernote/summernote-bs4.min.js"></script>
<!-- overlayScrollbars -->
<script src="plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/adminlte.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="dist/js/demo.js"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<!-- <script src="dist/js/pages/dashboard.js"></script> -->
</body>
</html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
<script type="module">
    // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyCicqYRIXYLpK53f3rEAlRrwsw2MMVO47c",
    authDomain: "iotphuc-520e0.firebaseapp.com",
    databaseURL: "https://iotphuc-520e0-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "iotphuc-520e0",
    storageBucket: "iotphuc-520e0.appspot.com",
    messagingSenderId: "188096986154",
    appId: "1:188096986154:web:1660ab283a33a0ae3d1753",
    measurementId: "G-DC7B6ZD1ZB"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  import {getDatabase, ref,get, set, child, update, remove} from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js"

  const db =  getDatabase();
  $(document).ready(function() {
    // Create a client instance
     var luuTTLed;
      const client = new Paho.MQTT.Client("ab76f209f2aa4b76b0944f485bcbd488.s1.eu.hivemq.cloud", Number(8884), "clientId_abcjdgn");

      // set callback handlers
      client.onConnectionLost = onConnectionLost;
      client.onMessageArrived = onMessageArrived;
      // connect the client
      client.connect({
        onSuccess:onConnect,	
        userName : "hphuc4244",
        password : "hphuc4244",
        useSSL: true});
      function onConnect() {
        console.log("onConnect");
        client.subscribe("ToNguyenHoangPhuc_Led_trangthai_caloc");
        client.subscribe("ToNguyenHoangPhuc_Led_trangthai_canho");
        client.subscribe("ToNguyenHoangPhuc_trangthai_nguon_1");
        client.subscribe("ToNguyenHoangPhuc_trangthai_nguon_2");

      }
      function onConnectionLost(responseObject) {
        if (responseObject.errorCode !== 0) {
          console.log("onConnectionLost:"+responseObject.errorMessage);
          // location.reload();
        }
      }
      function onMessageArrived(message) {
        console.log(message.destinationName);
        
        if(message.destinationName =="ToNguyenHoangPhuc_Led_trangthai_caloc")
        {
          updateData_caloc(message.payloadString);
         
          document.getElementById('trangthaiesp').textContent = "  ESP đang Online";
          document.getElementById('trangthaiesp').setAttribute("style", "color:rgb(19, 207, 75);font-weight: bold;");

        }else if(message.destinationName =="ToNguyenHoangPhuc_Led_trangthai_canho"){
          updateData_canho(message.payloadString)

        }else if(message.destinationName =="ToNguyenHoangPhuc_trangthai_nguon_1"){
          updateData_Nguon_1(message.payloadString)

        }else if(message.destinationName =="ToNguyenHoangPhuc_trangthai_nguon_2"){
          updateData_Nguon_2(message.payloadString)
        }
      }
      const dbref= ref(db);
        get(child(dbref,"TrangThaiLed")).then((snapshot)=>{
          luuTTLed=snapshot.val()
            if(luuTTLed == "tat")
            {
              $('.img_den_caloc').attr('src','./dist/img/den_off.png');
      
            }
            else
            {
              $('.img_den_caloc').attr('src','./dist/img/den_on.png');
            }
             
        });
        get(child(dbref,"TrangThaiLedCaNho")).then((snapshot)=>{
          luuTTLed=snapshot.val()
            if(luuTTLed == "tat")
            {
              $('.img_den_canho').attr('src','./dist/img/den_off.png');
      
            }
            else
            {
              $('.img_den_canho').attr('src','./dist/img/den_on.png');
            }
             
        });
        get(child(dbref,"Nguon_1")).then((snapshot)=>{
          luuTTLed=snapshot.val()
            if(luuTTLed == "tat")
            {
              $('.img_nguon_1').attr('src','./dist/img/den_off.png');
      
            }
            else
            {
              $('.img_nguon_1').attr('src','./dist/img/den_on.png');
            }
             
        });
        get(child(dbref,"Nguon_2")).then((snapshot)=>{
          luuTTLed=snapshot.val()
            if(luuTTLed == "tat")
            {
              $('.img_nguon_2').attr('src','./dist/img/den_off.png');
      
            }
            else
            {
              $('.img_nguon_2').attr('src','./dist/img/den_on.png');
            }
             
        });
        

      var den_off = "./dist/img/den_off.png";
      var den_on = "./dist/img/den_on.png";
      
       // MQTT hồ cá lóc
      var clicked = document.getElementById("bat/tatden-caloc")
      clicked.onclick = function(){
        var imgsr = $('.img_den_caloc').attr('src');
        if(imgsr === den_off){
            $('.img_den_caloc').attr('src', den_on);
            const message = new Paho.MQTT.Message("on");
            message.destinationName = "ToNguyenHoangPhuc_Led_caloc";
            client.send(message);
            console.log("Bat den");
        }
        else{
            $('.img_den_caloc').attr('src', den_off);
            const message = new Paho.MQTT.Message("off");
            message.destinationName = "ToNguyenHoangPhuc_Led_caloc";
            console.log("Gui, tat den")
            client.send(message);
        }
    };
     // MQTT hồ cá nhỏ
    var clicked = document.getElementById("bat/tatden-canho")
      clicked.onclick = function(){
        console.log("Clicked");
        var imgsr = $('.img_den_canho').attr('src');
        if(imgsr === den_off){
            $('.img_den_canho').attr('src', den_on);
            const message = new Paho.MQTT.Message("on");
            message.destinationName = "ToNguyenHoangPhuc_Led_canho";
            client.send(message);
            console.log("Bat den");
        }
        else{
            $('.img_den_canho').attr('src', den_off);
            const message = new Paho.MQTT.Message("off");
            message.destinationName = "ToNguyenHoangPhuc_Led_canho";
            console.log("Gui, tat den")
            client.send(message);
        }
    };
    // MQTT nguồn số 1
    var clicked = document.getElementById("bat/tat-nguon-1")
      clicked.onclick = function(){
        console.log("Clicked nguon 1");
        var imgsr = $('.img_nguon_1').attr('src');
        if(imgsr === den_off){
            $('.img_nguon_1').attr('src', den_on);
            const message = new Paho.MQTT.Message("on");
            message.destinationName = "ToNguyenHoangPhuc_nguon_A";
            client.send(message);
            console.log("Bat den");
        }
        else{
            $('.img_nguon_1').attr('src', den_off);
            const message = new Paho.MQTT.Message("off");
            message.destinationName = "ToNguyenHoangPhuc_nguon_A";
            console.log("Gui, tat den")
            client.send(message);
        }
    };
    // MQTT nguồn số 2
    var clicked = document.getElementById("bat/tat-nguon-2")
      clicked.onclick = function(){
        console.log("Clicked nguon 2");
        var imgsr = $('.img_nguon_2').attr('src');
        if(imgsr === den_off){
            $('.img_nguon_2').attr('src', den_on);
            const message = new Paho.MQTT.Message("on");
            message.destinationName = "ToNguyenHoangPhuc_nguon_B";
            client.send(message);
            console.log("Bat den");
        }
        else{
            $('.img_nguon_2').attr('src', den_off);
            const message = new Paho.MQTT.Message("off");
            message.destinationName = "ToNguyenHoangPhuc_nguon_B";
            console.log("Gui, tat den")
            client.send(message);
        }
    };
      function updateData_caloc(data){
        update(ref(db),{
          TrangThaiLed:data
        })
      }
      function updateData_canho(data){
        update(ref(db),{
          TrangThaiLedCaNho:data
        })
      }
      function updateData_Nguon_1(data){
        update(ref(db),{
          Nguon_1:data
        })
      }
      function updateData_Nguon_2(data){
        update(ref(db),{
          Nguon_2:data
        })
      }
  });
</script>
